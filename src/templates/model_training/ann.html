{% extends 'project_base.html' %}
{% block content %}

<div class="table2">
    <div class="jumbotron text-center jumbtron">
        <h1>Build Custom Neural Network</h1>
        <p>You can create your own custom neural network by adding components and train your data.
        </p> 
    </div>
    <div class="row">
        <div class="col-md-4 col-lg-4 col-sm-12">
            <h2 style="font-size: 24px;color: #112027fa;">Select Components</h2>
            <div class="input-btn" id="Input">
                <span>Input</span>
                <img src="{{url_for('static', filename='images/input.png')}}" class="img-input"/>
            </div>
                <div class="input-btn" id="Linear">
                    <span>Linear</span>
                    <img src="{{url_for('static', filename='images/layer.png')}}" class="img-input"/>
            </div>
                <div class="input-btn" id="Dropout">
                    <span>Dropout</span>
                <img src="{{url_for('static', filename='images/delete.png')}}" class="img-input"/> 
            </div>
                <div class="input-btn" id="Batch">
                    <span>Batch Norm</span>
                    <img src="{{url_for('static', filename='images/gaussian-function.png')}}" class="img-input"/>
            </div>
            <div class="input-btn" id="Output">
                <span>Output</span>
                <img src="{{url_for('static', filename='images/output.png')}}" class="img-input"/>
             </div>
        </div>
        <div class="col-md-4 col-lg-4 col-sm-12">
            <h2 style="font-size: 24px;color: #112027fa;">Network Architecture</h2>
            <div id="container_"  style=" height: 100%; overflow-y: auto;"></div>
        </div>
        <div class="col-md-4 col-lg-4 col-sm-12">
            <div id="configure">
                <h2 style="font-size: 24px;color: #112027fa;">Configure Unit</h2>
            </div>
        </div>
    </div>
    <button type="submit" class="btn btn-default show-loader" id="submit">Training</button>
</div>
<input type="hidden" id="hdn" value="" />
<script src="https://cdn.jsdelivr.net/npm/leader-line-new@1.1.9/leader-line.min.js"></script>
<script>
      let layerUnits=[]
      let lines=[]
      var ann=[]
      const editUnit=(id)=>{
        ann=[
          {type: 'input', id: 'input', units: 24, activation: 'Relu'},
          {type: 'linear', id: 'linear_1', units: 36, activation: 'Relu'},
          {type: 'batch_normalize', id: 'batch_normalize_1'},
          {type: 'dropout', id: 'dropout_1', perecent: 0.4},
          {type: 'linear', id: 'linear_2', units: 42, activation:  'Relu'},
          {type: 'batch_normalize', id: 'batch_normalize_2'},
          {type: 'dropout', id: 'dropout_2', perecent: 0.5},
          {type: 'linear', id: 'linear_3', units: 12, activation: 'Relu'},
          {type: 'output', id: 'output', units:1},
        ]
      }

    $(document).ready(()=>{
      $("#input_unit").on('click',()=>{
        alert(id)
      })

      $("#Input").on('click',()=>{
          let id_count=layerUnits.filter((x)=>x.type=='input').length
          if(id_count==0){
            let insert_item={type:'input',id:`input`,units:null,activation:null}
            layerUnits.push(insert_item)
            $("#container_").append(`<div id="input" class="linear input-div" onclick="editUnit('input')">
               <div>
                    <span>Input Layer</span>
                    <img src="{{url_for('static', filename='images/input.png')}}" class="img-input"/>
                </div>
               <div class="row2">
                    <div style="margin-right:40px">Activation: <span class='span2'>${insert_item.activation}</span></div>
                    <div>No of units:<span class='span2'>&nbsp;${insert_item.units}</span></div>
                </div>
                </div>`)
          }
      })
      $("#Linear").on('click',()=>{
          let input=layerUnits.filter((x)=>x.type=='input').length
          if(input==0){
              alert('Please add input layer first')
          }else{
            let id_count=layerUnits.filter((x)=>x.type=='linear').length
            id_count=id_count?id_count+1:1
            let id=`linear_${id_count}`
          layerUnits.push({type:'linear',id:`${id}`,units:undefined,activation:undefined,allowedDrop:true})
          $("#container_").append(`<div id="${id}" class="linear input-div" style="background:#e2d5a5" onclick="editUnit('${id}')">
               <div>
                    <span>Linear Layer(${id_count})</span>
                    <img src="{{url_for('static', filename='images/layer.png')}}" class="img-input"/>
                </div>
               <div class="row2">
                    <div style="margin-right:40px">Activation: <span class='span2'>null</span></div>
                    <div>No of units:<span class='span2'>null</span></div>
                </div>
                </div>`)
            if(layerUnits.length>0){
                let elems_=layerUnits.slice(layerUnits.length-2,layerUnits.length);
                debugger
                let line=new LeaderLine(
                        document.getElementById(elems_[0].id),
                        document.getElementById(elems_[1].id),
                        {dash: {animation: true}}
                );
                $("#container_").on('scroll', function() {
                    line.position();
                });
            }
          }
      })
      $("#Dropout").on('click',()=>{
          let input=layerUnits.filter((x)=>x.type=='input').length
          if(input==0){
              alert('Please add input layer first')
          }else{
            let id_count=layerUnits.filter((x)=>x.type=='dropout').length
            id_count=id_count?id_count+1:1
          layerUnits.push({type:'dropout',id:`dropout_${id_count}`,units:undefined,activation:undefined,allowedDrop:true})
          $("#container_").append(`<div id="dropout_${id_count}" class="linear input-div" style="background:#a8c9ab">
               <div>
                    <span>Dropout Layer(${id_count})</span>
                    <img src="{{url_for('static', filename='images/delete.png')}}" class="img-input"/>
                </div>
               <div class="row2">
                    <div style="margin-right:40px">Drop Percentage: <span class='span2'>null</span></div>
                </div>
                </div>`)
            if(layerUnits.length>1){
                let elems_=layerUnits.slice(layerUnits.length-2,layerUnits.length);
                let line=new LeaderLine(
                        document.getElementById(elems_[0].id),
                        document.getElementById(elems_[1].id),
                        {dash: {animation: true}}
                );
                $("#container_").on('scroll', function() {
                    line.position();
                });
            }
          }
      })
     
      $("#submit").click(function (event) {
          console.log('werewer')
          event.preventDefault();
          ann=[
            {type: 'input', id: 'input', units: 24, activation: 'Relu'},
            {type: 'linear', id: 'linear_1', units: 36, activation: 'Relu'},
            {type: 'batch_normalize', id: 'batch_normalize_1'},
            {type: 'dropout', id: 'dropout_1', perecent: 0.4},
            {type: 'linear', id: 'linear_2', units: 42, activation:  'Relu'},
            {type: 'batch_normalize', id: 'batch_normalize_2'},
            {type: 'dropout', id: 'dropout_2', perecent: 0.5},
            {type: 'linear', id: 'linear_3', units: 12, activation: 'Relu'},
            {type: 'output', id: 'output', units:1},
          ]
          $.ajax({
              type: "POST",
              url: "/model_training/ann",
              data: JSON.stringify(ann),
              processData: false,
              cache: false,
              timeout: 800000,
              success: function (data) {
                  console.log("SUCCESS : ", data);
              },
              error: function (e) {
                  console.log("ERROR : ", e);
              }
          });
      });
    })
</script>

<style>
    #start{
      height:40px;
      width:40px;
      background-color: coral;
    }
    #end{
      margin-top:200px;
      height:40px;
      width:40px;
      background-color: #18ce58;
    }
    #end2{
      margin-top:200px;
      height:40px;
      width:40px;
      background-color: coral;
    }
    .linear{
        height: 70px;
        width: 250px;
        background: #a5d3e2;
        border-radius: 20px;
        margin-bottom: 80px;
    }
    </style>
{% endblock %}
